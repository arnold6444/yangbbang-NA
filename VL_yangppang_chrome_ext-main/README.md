# Hedge Trading Helper - Chrome Extension

Lighter와 Variational 거래소에서 동시에 반대 포지션(헤지) 주문을 실행하고, 실시간 포지션 정보를 모니터링하며, 포지션 불균형을 자동으로 해결하는 고급 트레이딩 보조 도구입니다.

## 🎯 목표

두 거래소 간의 가격 차이를 이용한 차익 거래 또는 헤지 트레이딩 전략 실행 시, 수동 작업을 최소화하고 복잡한 주문 로직을 자동화하여 사용자의 편의성을 극대화하는 것을 목표로 합니다.

---

## ✨ 주요 기능

### 📊 실시간 모니터링
- **포지션 정보**: 각 거래소의 포지션 크기, 미실현 손익(PnL), 펀딩 수수료를 실시간으로 표시합니다.
- **계좌 잔액**: 각 거래소별 잔액 및 두 계좌의 총 합계를 USD 형식으로 표시합니다.
- **자동 갱신**: 모든 정보는 1초마다 자동으로 업데이트되어 항상 최신 상태를 유지합니다.

### 🚀 주문 실행 및 자동화
- **수동 주문**:
  - `L-Buy, V-Sell` / `L-Sell, V-Buy`: 헤지 방향을 설정합니다.
  - `Submit L` / `Submit V` / `Submit ALL`: 각 거래소 또는 양쪽 모두에 수동으로 주문을 제출합니다.
- **Lighter 오더북 연동**:
  - `X (Off)`: 시장가(Market) 주문을 준비합니다.
  - `0-10`: 선택한 번호의 Lighter 오더북 가격으로 지정가(Limit) 주문을 준비합니다.
- **오더북 가격 자동 새로고침**:
  - `Price Refresh`: 지정된 간격(기본 200ms)으로 Lighter의 오더북 가격을 자동으로 클릭하여 최신 지정가를 유지합니다. (Start/Stop 가능)
- **🤖 자동 헤지 (Auto limit L -> market V)**:
  - **지속적인 모니터링**: Lighter와 Variational의 포지션 불균형을 지정된 간격(기본 500ms)으로 감시합니다.
  - **자동 주문**: 두 포지션의 **순합계(Net Position)**가 설정된 `Delta` 값 이상으로 벌어지면, 불균형을 해소하기 위해 Variational에 자동으로 **시장가 주문**을 실행합니다.
  - **안전 장치**:
    - **주문 잠금(Lock)**: 불필요한 중복 주문을 방지하기 위해, 헷징 주문 실행 후 다음 사이클까지 대기합니다.
    - **잠금 타임아웃(Lock Timeout)**: 주문이 반영되지 않아 잠금이 풀리지 않는 경우를 대비해, 설정된 시간(기본 10초)이 지나면 잠금을 강제 해제하고 모니터링을 재개합니다.

### 🔧 편의 기능
- **거래 페어 동시 변경**: 코인 심볼 입력 후 `Set` 버튼으로 두 거래소의 거래 페이지를 동시에 전환합니다.
- **측면 패널 지원**: Chrome 브라우저의 측면 패널에서도 확장 프로그램을 사용할 수 있습니다. (확장 아이콘 우클릭 → "측면 패널에서 열기")

---

## 🚀 설치 및 설정

### 설치 방법
1.  **소스 코드 다운로드**: 이 저장소를 로컬 컴퓨터에 클론하거나 ZIP 파일로 다운로드합니다.
2.  **Chrome 확장 프로그램 페이지 열기**: 주소창에 `chrome://extensions`를 입력합니다.
3.  **개발자 모드 활성화**: 페이지 우측 상단의 '개발자 모드' 토글을 켭니다.
4.  **확장 프로그램 로드**: '압축해제된 확장 프로그램을 로드합니다' 버튼을 클릭하고, 다운로드한 프로젝트 폴더를 선택합니다.
5.  **툴바에 고정**: 브라우저 우측 상단 퍼즐 모양 아이콘을 클릭하여 'Hedge Trading Helper'를 고정합니다.

### 사전 설정
1.  Lighter (`https://app.lighter.xyz/trade/BTC`)와 Variational (`https://omni.variational.io/perpetual/BTC`) 탭을 각각 **하나씩만** 열어둡니다.
2.  두 거래소 모두 **로그인** 상태여야 합니다.

---

## 📖 사용 가이드

### 1. 수동 주문
1.  **코인 및 수량 설정**: `Coin Symbol`과 `Quantity`를 입력합니다.
2.  **Lighter 주문 유형 설정**:
    - **시장가**: `Lighter Orderbook`을 `X (Off)`로 설정합니다.
    - **지정가**: `Lighter Orderbook`에서 원하는 가격 위치(0-10)를 선택합니다.
3.  **방향 설정**: `L-Buy, V-Sell` 또는 `L-Sell, V-Buy` 버튼을 눌러 양쪽 거래소의 주문 방향을 설정합니다.
4.  **주문 제출**: `Submit L`, `Submit V`, `Submit ALL Orders` 버튼 중 하나를 클릭하여 주문을 실행합니다.

### 2. 오더북 가격 자동 새로고침 (Lighter 지정가)
1.  `Lighter Orderbook`에서 원하는 가격 위치(0-10)를 선택합니다.
2.  `Price Refresh` 주기를 설정합니다 (단위: ms).
3.  `L-Buy, V-Sell` 또는 `L-Sell, V-Buy` 버튼을 눌러 방향을 먼저 설정합니다.
4.  `Start` 버튼을 눌러 자동 새로고침을 시작합니다. `Stop` 버튼으로 언제든지 중지할 수 있습니다.

### 3. 자동 헤지 (Auto limit L -> market V)
이 기능은 Lighter에 먼저 주문을 넣고, 체결된 만큼 Variational에 자동으로 헷징 주문을 넣는 워크플로우를 자동화합니다.

1.  **수동으로 Lighter 주문**: 위 '수동 주문' 가이드에 따라 Lighter에 원하는 지정가 주문을 넣습니다. (예: `Submit L` 버튼 사용)
2.  **방향 설정**: `L-Buy, V-Sell` 또는 `L-Sell, V-Buy` 버튼을 클릭하여 전체적인 헷징 방향을 확장 프로그램에 알려줍니다.
3.  **파라미터 설정**:
    - `Delta`: 주문을 실행할 최소 포지션 불균형 크기.
    - `Interval`: 포지션 불균형을 체크할 주기 (ms).
    - `Lock Timeout`: 헷징 주문 후 잠금을 강제 해제할 시간 (s).
4.  **자동 헤지 시작**: `Auto limit L -> market V` 버튼을 클릭하여 모니터링을 시작합니다.
    - 버튼이 'STOP Auto HEDGE'로 바뀌고, 'Status'에 현재 상태가 표시됩니다.
5.  **자동 헤지 중지**: `STOP Auto HEDGE` 버튼을 다시 클릭하여 언제든지 모니터링을 중지할 수 있습니다.

---

## ⚠️ 중요 주의사항

-   **거래소 UI 변경**: 거래소 웹사이트의 HTML 구조가 변경되면 확장 프로그램이 오작동할 수 있습니다. 이 경우 `lighter.js`와 `variational.js` 파일 내의 `document.querySelector(...)` 부분을 직접 수정해야 합니다.
-   **안전한 사용**: 실제 거래 전 반드시 **소액**으로 모든 기능이 의도한 대로 동작하는지 충분히 테스트하십시오.
-   **네트워크 지연**: 네트워크 상태나 거래소 서버 응답 속도에 따라 자동화 기능의 정확성에 영향을 미칠 수 있습니다.

## 🐛 문제 해결 (Troubleshooting)

-   **정보가 `0`으로만 표시될 때**: 거래소 탭이 열려 있고, 로그인이 되어 있는지, 페이지 로딩이 완료되었는지 확인하세요.
-   **주문이 실행되지 않을 때**: 거래소의 최소 주문 수량, 증거금 등을 확인하세요.
-   **자동 헤지가 반복 실행될 때**: `Delta` 값을 너무 작게 설정하지 않았는지, `Lock Timeout`이 너무 짧지 않은지 확인하세요.

---

## 📜 라이선스
MIT License